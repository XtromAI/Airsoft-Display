# SH1107 Display Driver Efficiency Recommendations

> **STATUS:** Reference document - These are potential optimizations to consider after core functionality is complete.  
> See [2025-10-31-PROJECT-STATUS.md](2025-10-31-PROJECT-STATUS.md) for current implementation status.

This document outlines strategies to improve the efficiency of the SH1107 display driver for the Raspberry Pi Pico Airsoft project.

## 1. Partial/Dirty Region Updates
- **Current:** The driver always sends the entire framebuffer to the display.
- **Recommendation:** Track and update only the regions (pages or rectangles) that have changed. This reduces SPI traffic and speeds up refresh, especially for mostly-static screens.

## 2. Double Buffering (Optional)
- **Current:** Single framebuffer; updates may cause tearing if the buffer is modified while being sent.
- **Recommendation:** Use a second buffer for drawing, then swap and send only when ready. This helps avoid flicker and tearing.

## 3. SPI Speed and DMA
- **Current:** Uses blocking SPI writes.
- **Recommendation:**
  - Maximize SPI clock speed (check SH1107 datasheet for safe limits).
  - Use DMA for sending large data blocks to SPI, freeing up CPU and allowing other tasks to run in parallel.

## 4. Page-Oriented Drawing
- **Current:** Buffer is linear, but SH1107 is page-oriented (8-pixel tall pages).
- **Recommendation:**
  - Organize drawing and updates by page, so you can quickly update only the affected pages.
  - When drawing primitives, mark which pages are dirty.

## 5. Reduce Redundant Drawing
- **Current:** All primitives write to the buffer, and the whole buffer is sent.
- **Recommendation:**
  - Before drawing, check if the pixel/region is already in the desired state.
  - Avoid unnecessary writes to the buffer and display.

## 6. Optimize Font Rendering
- **Current:** Each character is drawn pixel-by-pixel.
- **Recommendation:**
  - For static text, pre-render strings to a buffer and blit them.
  - For frequently updated numbers (like shot count), only redraw the digits that change.

## 7. Power Management
- **Current:** Only `displayOn()` is provided.
- **Recommendation:**
  - Add support for display sleep modes or dimming when idle.
  - Reduce update frequency when the display is static.

## 8. Asynchronous/Non-blocking Updates
- **Current:** `display()` is blocking.
- **Recommendation:**
  - Allow display updates to be scheduled or performed in the background (e.g., via timer interrupt or RTOS task).

---

## Summary Table

| Optimization                | Benefit                        | Implementation Notes                |
|-----------------------------|--------------------------------|-------------------------------------|
| Dirty region/page tracking  | Less SPI traffic, faster update| Track changed regions, update only those |
| DMA for SPI                 | Frees CPU, faster transfer     | Use DMA for `spi_write_data_buffer` |
| Max SPI speed               | Faster updates                 | Check SH1107 datasheet for max safe speed |
| Double buffering            | No tearing/flicker             | Use if you have enough RAM          |
| Page-oriented drawing       | Efficient updates              | Mark and update only changed pages  |
| Power management            | Lower power, longer life       | Use SH1107 sleep/dim commands       |
| Asynchronous updates        | Smoother UI, less blocking     | Use interrupts or RTOS tasks        |
